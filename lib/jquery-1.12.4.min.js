/*!
 * Minimal jQuery-compatible library for Web Studio
 * Implements only the features needed for this application
 */
(function(window) {
    'use strict';
    
    var $ = function(selector) {
        return new $.fn.init(selector);
    };
    
    $.fn = $.prototype = {
        constructor: $,
        length: 0,
        
        init: function(selector) {
            if (!selector) {
                return this;
            }
            
            if (typeof selector === 'function') {
                // Document ready
                if (document.readyState === 'complete' || document.readyState === 'interactive') {
                    setTimeout(selector, 0);
                } else {
                    document.addEventListener('DOMContentLoaded', selector);
                }
                return this;
            }
            
            if (typeof selector === 'string') {
                var elements = document.querySelectorAll(selector);
                this.length = elements.length;
                for (var i = 0; i < elements.length; i++) {
                    this[i] = elements[i];
                }
            } else if (selector.nodeType) {
                this[0] = selector;
                this.length = 1;
            }
            
            return this;
        },
        
        each: function(callback) {
            for (var i = 0; i < this.length; i++) {
                callback.call(this[i], i, this[i]);
            }
            return this;
        },
        
        on: function(event, handler) {
            return this.each(function() {
                this.addEventListener(event, handler);
            });
        },
        
        off: function(event, handler) {
            return this.each(function() {
                this.removeEventListener(event, handler);
            });
        },
        
        val: function(value) {
            if (value === undefined) {
                return this.length > 0 ? this[0].value : undefined;
            }
            return this.each(function() {
                this.value = value;
            });
        },
        
        text: function(text) {
            if (text === undefined) {
                return this.length > 0 ? this[0].textContent : undefined;
            }
            return this.each(function() {
                this.textContent = text;
            });
        },
        
        html: function(html) {
            if (html === undefined) {
                return this.length > 0 ? this[0].innerHTML : undefined;
            }
            return this.each(function() {
                this.innerHTML = html;
            });
        },
        
        addClass: function(className) {
            return this.each(function() {
                this.classList.add(className);
            });
        },
        
        removeClass: function(className) {
            return this.each(function() {
                this.classList.remove(className);
            });
        },
        
        toggleClass: function(className) {
            return this.each(function() {
                this.classList.toggle(className);
            });
        },
        
        hasClass: function(className) {
            return this.length > 0 && this[0].classList.contains(className);
        },
        
        attr: function(name, value) {
            if (value === undefined) {
                return this.length > 0 ? this[0].getAttribute(name) : undefined;
            }
            return this.each(function() {
                this.setAttribute(name, value);
            });
        },
        
        prop: function(name, value) {
            if (value === undefined) {
                return this.length > 0 ? this[0][name] : undefined;
            }
            return this.each(function() {
                this[name] = value;
            });
        },
        
        data: function(name, value) {
            if (value === undefined) {
                return this.length > 0 ? this[0].dataset[name] : undefined;
            }
            return this.each(function() {
                this.dataset[name] = value;
            });
        },
        
        show: function() {
            return this.each(function() {
                this.style.display = '';
            });
        },
        
        hide: function() {
            return this.each(function() {
                this.style.display = 'none';
            });
        },
        
        append: function(content) {
            return this.each(function() {
                if (typeof content === 'string') {
                    this.insertAdjacentHTML('beforeend', content);
                } else if (content.nodeType) {
                    this.appendChild(content);
                } else if (content.length) {
                    for (var i = 0; i < content.length; i++) {
                        if (content[i].nodeType) {
                            this.appendChild(content[i]);
                        }
                    }
                }
            });
        },
        
        empty: function() {
            return this.each(function() {
                this.innerHTML = '';
            });
        }
    };
    
    $.fn.init.prototype = $.fn;
    
    // AJAX support
    $.ajax = function(options) {
        var xhr = new XMLHttpRequest();
        var method = options.type || options.method || 'GET';
        var url = options.url;
        var async = options.async !== false;
        
        xhr.open(method, url, async);
        
        if (options.contentType) {
            xhr.setRequestHeader('Content-Type', options.contentType);
        }
        
        if (options.timeout) {
            xhr.timeout = options.timeout;
        }
        
        xhr.onload = function() {
            if (xhr.status >= 200 && xhr.status < 300) {
                var response = xhr.responseText;
                if (options.dataType === 'json' || options.contentType === 'application/json') {
                    try {
                        response = JSON.parse(response);
                    } catch (e) {
                        console.error('Error parsing JSON:', e);
                    }
                }
                if (options.success) {
                    options.success(response, xhr.statusText, xhr);
                }
            } else {
                if (options.error) {
                    options.error(xhr, xhr.statusText, xhr.statusText);
                }
            }
        };
        
        xhr.onerror = function() {
            if (options.error) {
                options.error(xhr, 'error', 'Network error');
            }
        };
        
        xhr.ontimeout = function() {
            if (options.error) {
                options.error(xhr, 'timeout', 'Request timeout');
            }
        };
        
        var data = options.data;
        if (data && typeof data === 'object' && options.contentType === 'application/json') {
            data = JSON.stringify(data);
        }
        
        xhr.send(data);
        
        return xhr;
    };
    
    // Document ready shorthand
    $.ready = function(callback) {
        return $(callback);
    };
    
    window.jQuery = window.$ = $;
    
})(window);
